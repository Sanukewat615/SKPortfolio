<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Weather App with Theme Switcher</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
    rel="stylesheet"
  />
  <style>
    body {
      font-family: 'Inter', sans-serif;
      min-height: 100vh;
      margin: 0;
      padding: 0;
      transition: background 0.5s ease, color 0.5s ease;
    }
    input:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(255 165 0 / 0.6);
    }
    /* Scrollbar for forecast container */
    #forecastContainer {
      scrollbar-width: thin;
      scrollbar-color: #f97316 transparent;
    }
    #forecastContainer::-webkit-scrollbar {
      height: 8px;
    }
    #forecastContainer::-webkit-scrollbar-track {
      background: transparent;
    }
    #forecastContainer::-webkit-scrollbar-thumb {
      background-color: #f97316;
      border-radius: 10px;
    }
  </style>
  <script>
    // Tailwind config for dark mode class strategy
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {},
      },
    };
  </script>
</head>
<body class="flex flex-col min-h-screen bg-gradient-to-br from-cyan-400 to-blue-700 text-white transition-colors duration-500" id="body">
  <header class="bg-black bg-opacity-30 dark:bg-gray-900 dark:bg-opacity-70 py-6 shadow-md sticky top-0 z-30 flex items-center justify-between px-6 max-w-4xl mx-auto w-full">
    <h1 class="text-center text-3xl font-semibold tracking-wide select-none flex items-center gap-2">
      <i class="fas fa-cloud-sun"></i> Weather App
    </h1>
    <button
      id="themeToggleBtn"
      aria-label="Toggle light and dark theme"
      class="text-white dark:text-yellow-400 hover:text-yellow-300 dark:hover:text-yellow-500 transition-colors text-xl focus:outline-none"
      title="Toggle Light/Dark Theme"
    >
      <i class="fas fa-moon"></i>
    </button>
  </header>

  <main class="flex-grow flex flex-col items-center px-4 py-8 max-w-md mx-auto w-full">
    <section
      class="w-full bg-white bg-opacity-20 dark:bg-gray-800 dark:bg-opacity-40 backdrop-blur-md rounded-xl p-6 shadow-lg flex flex-col items-center transition-colors duration-500"
    >
      <form
        id="searchForm"
        class="w-full flex flex-col sm:flex-row items-center gap-4"
        autocomplete="off"
        onsubmit="return false"
      >
        <input
          id="cityName"
          type="text"
          placeholder="Enter City"
          class="flex-grow rounded-lg px-4 py-3 font-medium placeholder-gray-600 dark:placeholder-gray-400 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-orange-400"
          aria-label="Enter city name"
          required
        />
        <button
          id="searchBtn"
          type="submit"
          class="bg-orange-500 hover:bg-orange-600 dark:bg-orange-600 dark:hover:bg-orange-700 transition-colors rounded-lg px-6 py-3 font-semibold text-white shadow-md flex items-center justify-center gap-2"
          aria-label="Search weather by city"
        >
          <i class="fas fa-search"></i> Search
        </button>
      </form>

      <p class="my-4 font-semibold">Or</p>

      <button
        id="locationBtn"
        class="bg-orange-500 hover:bg-orange-600 dark:bg-orange-600 dark:hover:bg-orange-700 transition-colors rounded-lg px-6 py-3 font-semibold text-white shadow-md flex items-center justify-center gap-2 w-full sm:w-auto"
        aria-label="Get weather by current location"
      >
        <i class="fas fa-map-marker-alt"></i> Current Location
      </button>
    </section>

    <section
      id="secondDiv"
      class="mt-10 w-full bg-white bg-opacity-20 dark:bg-gray-800 dark:bg-opacity-40 backdrop-blur-md rounded-xl p-8 shadow-lg flex flex-col items-center transition-colors duration-500"
      aria-live="polite"
      aria-atomic="true"
    >
      <div id="weatherInfo" class="text-center w-full max-w-sm">
        <p
          id="temp"
          class="text-6xl font-extrabold tracking-tight drop-shadow-lg select-text"
          aria-label="Temperature"
        >
          -- °C
        </p>
        <p
          id="city"
          class="text-2xl font-semibold mt-2 mb-8 drop-shadow-md select-text"
          aria-label="City name"
        >
          --
        </p>

        <div
          class="flex justify-around gap-8 text-white dark:text-gray-200 text-center select-text"
          role="list"
          aria-label="Additional weather information"
        >
          <div role="listitem" class="flex flex-col items-center">
            <i class="fas fa-wind text-3xl mb-1"></i>
            <p class="font-semibold">Wind</p>
            <p id="wind" class="text-lg">--</p>
          </div>
          <div role="listitem" class="flex flex-col items-center">
            <i class="fas fa-tachometer-alt text-3xl mb-1"></i>
            <p class="font-semibold">Pressure</p>
            <p id="pressure" class="text-lg">--</p>
          </div>
          <div role="listitem" class="flex flex-col items-center">
            <i class="fas fa-tint text-3xl mb-1"></i>
            <p class="font-semibold">Humidity</p>
            <p id="humidity" class="text-lg">--</p>
          </div>
        </div>
      </div>
    </section>

    <section
      id="forecastSection"
      class="mt-10 w-full max-w-md bg-white bg-opacity-20 dark:bg-gray-800 dark:bg-opacity-40 backdrop-blur-md rounded-xl p-6 shadow-lg hidden transition-colors duration-500"
      aria-label="5 day weather forecast"
    >
      <h2 class="text-white dark:text-gray-200 text-2xl font-semibold mb-6 text-center">
        5-Day Forecast
      </h2>
      <div
        id="forecastContainer"
        class="grid grid-cols-1 sm:grid-cols-5 gap-4 text-white dark:text-gray-200 overflow-x-auto"
      >
        <!-- Forecast cards will be inserted here -->
      </div>
    </section>
  </main>

  <footer class="bg-black bg-opacity-30 dark:bg-gray-900 dark:bg-opacity-70 text-white dark:text-gray-300 text-center py-4 select-none transition-colors duration-500">
    <p>
      &copy; 2025 Weather App &nbsp;|&nbsp;
      <a
        href="https://openweathermap.org/"
        target="_blank"
        rel="noopener noreferrer"
        class="underline hover:text-orange-400 dark:hover:text-orange-500"
        >SK Weather app </a
      >
    </p>
  </footer>

  <script>
    const apiKey = "515def936b97d0a7447eee11b7e75311";

    const searchBtn = document.getElementById("searchBtn");
    const locationBtn = document.getElementById("locationBtn");
    const cityInput = document.getElementById("cityName");
    const tempEl = document.getElementById("temp");
    const cityEl = document.getElementById("city");
    const windEl = document.getElementById("wind");
    const pressureEl = document.getElementById("pressure");
    const humidityEl = document.getElementById("humidity");
    const forecastSection = document.getElementById("forecastSection");
    const forecastContainer = document.getElementById("forecastContainer");
    const searchForm = document.getElementById("searchForm");
    const themeToggleBtn = document.getElementById("themeToggleBtn");
    const body = document.getElementById("body");

    // Initialize theme from localStorage or system preference
    function initTheme() {
      const savedTheme = localStorage.getItem("theme");
      if (savedTheme === "dark") {
        body.classList.add("dark");
        themeToggleBtn.innerHTML = '<i class="fas fa-sun"></i>';
        themeToggleBtn.title = "Switch to Light Theme";
      } else if (savedTheme === "light") {
        body.classList.remove("dark");
        themeToggleBtn.innerHTML = '<i class="fas fa-moon"></i>';
        themeToggleBtn.title = "Switch to Dark Theme";
      } else {
        // No saved theme, use system preference
        if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
          body.classList.add("dark");
          themeToggleBtn.innerHTML = '<i class="fas fa-sun"></i>';
          themeToggleBtn.title = "Switch to Light Theme";
        } else {
          body.classList.remove("dark");
          themeToggleBtn.innerHTML = '<i class="fas fa-moon"></i>';
          themeToggleBtn.title = "Switch to Dark Theme";
        }
      }
    }

    // Toggle theme and save preference
    function toggleTheme() {
      if (body.classList.contains("dark")) {
        body.classList.remove("dark");
        localStorage.setItem("theme", "light");
        themeToggleBtn.innerHTML = '<i class="fas fa-moon"></i>';
        themeToggleBtn.title = "Switch to Dark Theme";
      } else {
        body.classList.add("dark");
        localStorage.setItem("theme", "dark");
        themeToggleBtn.innerHTML = '<i class="fas fa-sun"></i>';
        themeToggleBtn.title = "Switch to Light Theme";
      }
    }

    // Helper: format date to weekday short
    function formatDate(dt_txt) {
      const date = new Date(dt_txt);
      return date.toLocaleDateString(undefined, { weekday: "short" });
    }

    // Show weather data in UI
    function showWeather(data) {
      if (data.cod !== 200) {
        alert("City not found!");
        return;
      }
      tempEl.innerText = Math.round(data.main.temp) + " °C";
      cityEl.innerText = data.name + ", " + data.sys.country;
      windEl.innerText = data.wind.speed + " km/h";
      pressureEl.innerText = data.main.pressure + " hPa";
      humidityEl.innerText = data.main.humidity + "%";

      // Show weather icon with description
      const iconCode = data.weather[0].icon;
      const description = data.weather[0].description;
      if (!document.getElementById("weatherIcon")) {
        const iconImg = document.createElement("img");
        iconImg.id = "weatherIcon";
        iconImg.alt = description + " weather icon";
        iconImg.className = "mx-auto mt-2 w-24 h-24 drop-shadow-lg";
        cityEl.insertAdjacentElement("afterend", iconImg);
      }
      document.getElementById(
        "weatherIcon"
      ).src = `https://openweathermap.org/img/wn/${iconCode}@4x.png`;
      document.getElementById("weatherIcon").alt = description + " weather icon";

      // Fetch and show 5-day forecast
      fetchForecast(data.coord.lat, data.coord.lon);
    }

    // Show forecast data
    function showForecast(data) {
      // Clear previous forecast
      forecastContainer.innerHTML = "";

      // Group forecast by day (OpenWeatherMap returns 3-hour intervals)
      const dailyData = {};
      data.list.forEach((item) => {
        const day = item.dt_txt.split(" ")[0];
        if (!dailyData[day]) dailyData[day] = [];
        dailyData[day].push(item);
      });

      // We want next 5 days (including today)
      const days = Object.keys(dailyData).slice(0, 5);

      days.forEach((day) => {
        // Pick the forecast closest to midday (12:00) for each day
        const middayForecast = dailyData[day].reduce((prev, curr) => {
          return Math.abs(new Date(curr.dt_txt).getHours() - 12) <
            Math.abs(new Date(prev.dt_txt).getHours() - 12)
            ? curr
            : prev;
        });

        const dateObj = new Date(middayForecast.dt_txt);
        const dayName = dateObj.toLocaleDateString(undefined, {
          weekday: "short",
        });
        const temp = Math.round(middayForecast.main.temp);
        const icon = middayForecast.weather[0].icon;
        const desc = middayForecast.weather[0].description;

        // Create forecast card
        const card = document.createElement("div");
        card.className =
          "bg-white bg-opacity-30 dark:bg-gray-700 dark:bg-opacity-50 rounded-lg p-3 flex flex-col items-center shadow-md transition-colors duration-500";

        const dayEl = document.createElement("p");
        dayEl.className = "font-semibold mb-1 text-gray-900 dark:text-gray-100";
        dayEl.textContent = dayName;

        const iconEl = document.createElement("img");
        iconEl.src = `https://openweathermap.org/img/wn/${icon}@2x.png`;
        iconEl.alt = desc + " weather icon";
        iconEl.className = "w-16 h-16";

        const tempEl = document.createElement("p");
        tempEl.className =
          "text-lg font-bold mt-1 text-gray-900 dark:text-gray-100";
        tempEl.textContent = temp + " °C";

        card.appendChild(dayEl);
        card.appendChild(iconEl);
        card.appendChild(tempEl);

        forecastContainer.appendChild(card);
      });

      forecastSection.classList.remove("hidden");
    }

    // Fetch weather by city name
    async function fetchWeather(city) {
      try {
        const url = `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(
          city
        )}&appid=${apiKey}&units=metric`;
        const response = await fetch(url);
        const data = await response.json();
        showWeather(data);
      } catch (error) {
        alert("Failed to fetch weather data.");
      }
    }

    // Fetch weather by coordinates
    async function fetchWeatherByLocation(lat, lon) {
      try {
        const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric`;
        const response = await fetch(url);
        const data = await response.json();
        showWeather(data);
      } catch (error) {
        alert("Failed to fetch weather data.");
      }
    }

    // Fetch 5-day forecast by coordinates
    async function fetchForecast(lat, lon) {
      try {
        const url = `https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric`;
        const response = await fetch(url);
        const data = await response.json();
        if (data.cod === "200") {
          showForecast(data);
        } else {
          forecastSection.classList.add("hidden");
        }
      } catch (error) {
        forecastSection.classList.add("hidden");
      }
    }

    // Event listeners
    searchBtn.addEventListener("click", () => {
      const city = cityInput.value.trim();
      if (city) {
        fetchWeather(city);
        cityInput.blur();
      }
    });

    locationBtn.addEventListener("click", () => {
      if (navigator.geolocation) {
        locationBtn.disabled = true;
        locationBtn.innerHTML =
          '<i class="fas fa-spinner fa-spin"></i> Locating...';
        navigator.geolocation.getCurrentPosition(
          (pos) => {
            fetchWeatherByLocation(pos.coords.latitude, pos.coords.longitude);
            locationBtn.disabled = false;
            locationBtn.innerHTML =
              '<i class="fas fa-map-marker-alt"></i> Current Location';
          },
          () => {
            alert("Unable to retrieve your location.");
            locationBtn.disabled = false;
            locationBtn.innerHTML =
              '<i class="fas fa-map-marker-alt"></i> Current Location';
          }
        );
      } else {
        alert("Geolocation is not supported by your browser.");
      }
    });

    // Support pressing Enter key in input to search
    searchForm.addEventListener("submit", (e) => {
      e.preventDefault();
      searchBtn.click();
    });

    // Theme toggle button
    themeToggleBtn.addEventListener("click", toggleTheme);

    // Initialize theme on load
    window.addEventListener("load", () => {
      initTheme();
      fetchWeather("Jabalpur");
    });
  </script>
</body>
</html>